<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tipografias EAD Font Catalogue</title>
  <style>
    body { font-family: sans-serif; margin: 2em; background: #faf9f6; color: #222; }
    h1 { font-size: 2em; margin-bottom: 1em; }
    .controls { margin-bottom: 2em; padding: 1em; background: #e6f0f7; border-radius: 8px; display: flex; flex-wrap: wrap; gap: 1.5em; align-items: center; }
    .controls label { margin-right: 0.4em; white-space: nowrap; }
    .year-block { margin-bottom: 2.5em; }
    .year-title { font-size: 1.5em; margin-bottom: 0.6em; color: #1b4366; border-bottom: 2px solid #b1d0e0; }
    .author-block { margin-bottom: 1.3em; margin-left: 1.5em; }
    .author-title { font-size: 1.17em; font-weight: 600; margin-bottom: 0.4em; color: #1a273a; }
    .font-list { margin-left: 1.5em; }
    .font-item { background: #fff; border-radius: 7px; box-shadow: 0 1px 4px #0001; padding: 0.7em 1em; margin-bottom: 0.7em; }
    .font-name { font-weight: bold; }
    .font-link, .specimen-link { display: inline-block; margin-right: 1em; margin-bottom: 3px; }
    .font-tags { font-size: 0.91em; color: #475; margin-top: 0.3em; }
    .font-tag { background: #e1f3d8; border-radius: 4px; padding: 1px 7px; margin-right: 0.4em; }
    .font-preview { display: block; margin-top: 0.5em; font-size: 1.5em; background: #faf3db; color: #262626; padding: 0.4em 0.8em; border-radius: 4px; transition: background 0.2s, color 0.2s, font-size 0.2s, letter-spacing 0.2s; }
    @media (max-width: 600px) {
      .controls { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <h1>Tipografias EAD Font Catalogue</h1>
  <div class="controls">
    <label>
      Font color:
      <input type="color" id="fontColor" value="#262626">
    </label>
    <label>
      Background color:
      <input type="color" id="bgColor" value="#faf3db">
    </label>
    <label>
      Font size:
      <input type="range" id="fontSize" min="12" max="120" value="24">
      <span id="fontSizeValue">24</span>px
    </label>
    <label>
      Letter spacing:
      <input type="range" id="letterSpacing" min="0" max="1" step="0.01" value="0">
      <span id="letterSpacingValue">0</span>em
    </label>
  </div>
  <div id="output"></div>
  <script type="module">
    import fonts from './catalogue.js';

    // Group data: year > author > [fonts/specimens]
    const years = {};
    fonts.forEach(entry => {
      if (!years[entry.year]) years[entry.year] = {};
      if (!years[entry.year][entry.author]) years[entry.year][entry.author] = [];
      years[entry.year][entry.author].push(entry);
    });

    function isPdf(file) {
      return typeof file === "string" && file.toLowerCase().endsWith('.pdf');
    }

    function makeSpecimenLinks(specimen) {
      if (!specimen) return '';
      const pdfs = Array.isArray(specimen)
        ? specimen.filter(isPdf)
        : isPdf(specimen) ? [specimen] : [];
      if (pdfs.length === 0) return '';
      return pdfs.map(s =>
        `<a class="specimen-link" href="${s}" target="_blank" rel="noopener">Font specimen: ${s.split('/').pop()}</a>`
      ).join('<br>');
    }

    function makeTags(tags) {
      if (!tags || tags.length === 0) return '';
      return `<span class="font-tags">${tags.map(tag => `<span class="font-tag">${tag}</span>`).join('')}</span>`;
    }

    // Dynamically inject @font-face for each font file and return the family name to use
    function registerFont(fontFile, fontName, uniqueSuffix) {
      const fontId = `Font_${fontName.replace(/\W+/g, '')}_${uniqueSuffix}`;
      if (document.getElementById(fontId)) return fontId;
      const style = document.createElement('style');
      style.id = fontId;
      style.textContent = `
        @font-face {
          font-family: '${fontId}';
          src: url('${fontFile}');
        }
      `;
      document.head.appendChild(style);
      return fontId;
    }

    const output = document.getElementById('output');
    // Initial style values
    let previewStyles = {
      color: document.getElementById('fontColor').value,
      background: document.getElementById('bgColor').value,
      fontSize: document.getElementById('fontSize').value + 'px',
      letterSpacing: document.getElementById('letterSpacing').value + 'em',
    };

    // Render catalogue
    function renderCatalogue() {
      output.innerHTML = '';
      Object.keys(years).sort().forEach(year => {
        const yearDiv = document.createElement('div');
        yearDiv.className = 'year-block';
        yearDiv.innerHTML = `<div class="year-title">${year}</div>`;
        Object.keys(years[year]).sort().forEach(author => {
          const authorDiv = document.createElement('div');
          authorDiv.className = 'author-block';
          authorDiv.innerHTML = `<div class="author-title">${author}</div>`;
          const fontEntries = years[year][author].filter(e => e.file || e.name || e.specimen);
          if (fontEntries.length === 0) return;
          const fontList = document.createElement('div');
          fontList.className = 'font-list';
          fontEntries.forEach((font, idx) => {
            const fontDiv = document.createElement('div');
            fontDiv.className = 'font-item';
            let preview = '';
            if (font.file && (font.file.endsWith('.otf') || font.file.endsWith('.ttf'))) {
              // Register font and create preview
              const fam = registerFont(font.file, font.name || 'Font', year + author + idx);
              preview = `<span class="font-preview" 
                style="font-family: '${fam}', sans-serif; color: ${previewStyles.color}; background: ${previewStyles.background}; font-size: ${previewStyles.fontSize}; letter-spacing: ${previewStyles.letterSpacing};"
                >The quick brown fox jumps over the lazy dog. 1234567890</span>`;
            }
            fontDiv.innerHTML = `
              ${font.name ? `<span class="font-name">${font.name}</span><br>` : ''}
              ${font.file ? `<a class="font-link" href="${font.file}" download>Download font</a><br>` : ''}
              ${makeSpecimenLinks(font.specimen)}
              ${makeTags(font.tags)}
              ${preview}
            `;
            fontList.appendChild(fontDiv);
          });
          authorDiv.appendChild(fontList);
          yearDiv.appendChild(authorDiv);
        });
        output.appendChild(yearDiv);
      });
    }

    // Initial render
    renderCatalogue();

    // Controls
    const fontColor = document.getElementById('fontColor');
    const bgColor = document.getElementById('bgColor');
    const fontSize = document.getElementById('fontSize');
    const fontSizeValue = document.getElementById('fontSizeValue');
    const letterSpacing = document.getElementById('letterSpacing');
    const letterSpacingValue = document.getElementById('letterSpacingValue');

    function updatePreviews() {
      previewStyles.color = fontColor.value;
      previewStyles.background = bgColor.value;
      previewStyles.fontSize = fontSize.value + 'px';
      previewStyles.letterSpacing = letterSpacing.value + 'em';
      // Update the font size/spacing indicators
      fontSizeValue.textContent = fontSize.value;
      letterSpacingValue.textContent = letterSpacing.value;
      // Update all font previews
      document.querySelectorAll('.font-preview').forEach(el => {
        el.style.color = previewStyles.color;
        el.style.background = previewStyles.background;
        el.style.fontSize = previewStyles.fontSize;
        el.style.letterSpacing = previewStyles.letterSpacing;
      });
    }

    fontColor.addEventListener('input', updatePreviews);
    bgColor.addEventListener('input', updatePreviews);
    fontSize.addEventListener('input', updatePreviews);
    letterSpacing.addEventListener('input', updatePreviews);

    // Also update after rerender (e.g. after changing controls)
    [fontColor, bgColor, fontSize, letterSpacing].forEach(ctrl => {
      ctrl.addEventListener('input', () => {
        updatePreviews();
      });
    });

  </script>
</body>
</html>