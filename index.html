<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tipografias EAD Font Catalogue</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="loading-overlay">
    <div class="spinner"></div>
    <div>Loading catalogue...</div>
  </div>

  <div class="container">
    <h1>Tipografias EAD Font Catalogue</h1>
    <div class="controls">
      <label>
        Font color:
        <input type="color" id="fontColor" value="#262626">
      </label>
      <label>
        Background color:
        <input type="color" id="bgColor" value="#ffffff">
      </label>
      <label>
        Font size:
        <input type="range" id="fontSize" min="12" max="120" value="24">
        <span id="fontSizeValue">24</span>px
      </label>
      <label>
        Letter spacing:
        <input type="range" id="letterSpacing" min="0" max="1" step="0.01" value="0">
        <span id="letterSpacingValue">0</span>em
      </label>
    </div>
    <div class="filters">
      <label>
        Filter by Asignatura:
        <select id="AsignaturaFilter">
          <option value="">Todas las Asignaturas</option>
          <option value="Taller de Tipografía 2020">Taller de Tipografía 2020</option>
          <option value="Taller de Tipografía 2021">Taller de Tipografía 2021</option>
          <option value="Taller de Tipografía 2024">Taller de Tipografía 2024</option>
          <option value="Diseño Tipográfico 2024">Diseño Tipográfico 2024</option>
        </select>
      </label>
      <label>
        Filter by year:
        <select id="yearFilter">
          <option value="">All years</option>
        </select>
      </label>
      <label>
        Filter by teacher:
        <select id="teacherFilter">
          <option value="">All teachers</option>
          <option value="Manuel F. Sanfuentes">Manuel F. Sanfuentes</option>
          <option value="Alejandro Garretón">Alejandro Garretón</option>
          <option value="Andrea Torres">Andrea Torres</option>
        </select>
      </label>
    </div>

    <!-- Tag panel moved here -->
    <nav id="tag-panel">
      <div class="tag-panel-title">Tags</div>
      <div id="tag-list">
        <button class="tag-btn" data-tag="">All</button>
        <button class="tag-btn" data-tag="Serif">Serif</button>
        <button class="tag-btn" data-tag="humanistas">humanistas</button>
        <button class="tag-btn" data-tag="transicionales">transicionales</button>
        <button class="tag-btn" data-tag="modernas">modernas</button>
        <button class="tag-btn" data-tag="mecanas">mecanas</button>
        <button class="tag-btn" data-tag="Sanserif">Sanserif</button>
        <button class="tag-btn" data-tag="grotescas">grotescas</button>
        <button class="tag-btn" data-tag="neogrotescas">neogrotescas</button>
        <button class="tag-btn" data-tag="geométricas">geométricas</button>
        <button class="tag-btn" data-tag="góticas">góticas</button>
        <button class="tag-btn" data-tag="manuscritas">manuscritas</button>
        <button class="tag-btn" data-tag="Display">Display</button>
        <button class="tag-btn" data-tag="Modulares">Modulares</button>
      </div>
    </nav>

    <div id="output"></div>
  </div>
  <footer style="text-align: center; margin: 2em 0;">
    <img src="footer.png" alt="Footer image" style="max-width: 20%; height: auto;">
  </footer>
  <script type="module">
    import fonts from './catalogue.js';

    function getSpecimenImage(font) {
      // Use year/author/thumb.png as the thumbnail path
      return `${font.year}/${font.author}/thumb.png`;
    }

    function makeSpecimenDisplay(font) {
      const img = getSpecimenImage(font);
      return `<img class="specimen-thumb" src="${img}" alt="Specimen for ${font.name}" title="Specimen for ${font.name}">`;
    }

    function isPdf(file) {
      return typeof file === "string" && file.toLowerCase().endsWith('.pdf');
    }

    function makePdfDisplay(specimen, fontName = "") {
      // Only show PDF link if there's a PDF
      if (!specimen) return '';
      if (Array.isArray(specimen)) {
        return specimen.filter(isPdf).map(pdf => `<a class="specimen-link" href="${pdf}" target="_blank" rel="noopener">PDF specimen: ${fontName || pdf.split('/').pop()}</a>`).join(' ');
      } else if (isPdf(specimen)) {
        return `<a class="specimen-link" href="${specimen}" target="_blank" rel="noopener">PDF specimen: ${fontName || specimen.split('/').pop()}</a>`;
      }
      return '';
    }

    function makeTags(tags) {
      if (!tags || tags.length === 0) return '';
      return `<span class="font-tags">${tags.map(tag => `<span class="font-tag">${tag}</span>`).join('')}</span>`;
    }

    function registerFont(fontFile, fontName, uniqueSuffix) {
      const fontId = `Font_${fontName.replace(/\W+/g, '')}_${uniqueSuffix}`;
      if (document.getElementById(fontId)) return fontId;
      const style = document.createElement('style');
      style.id = fontId;
      style.textContent = `
        @font-face {
          font-family: '${fontId}';
          src: url('${fontFile}');
        }
      `;
      document.head.appendChild(style);
      return fontId;
    }

    function groupFonts(fontsArr) {
      const years = {};
      fontsArr.forEach(entry => {
        if (!years[entry.year]) years[entry.year] = {};
        if (!years[entry.year][entry.author]) years[entry.year][entry.author] = [];
        years[entry.year][entry.author].push(entry);
      });
      return years;
    }

    function extractYearsAndTags(fontsArr) {
      const yearSet = new Set();
      const tagSet = new Set();
      fontsArr.forEach(f => {
        yearSet.add(f.year);
        (f.tags || []).forEach(tag => tagSet.add(tag));
      });
      return {years: Array.from(yearSet).sort(), tags: Array.from(tagSet).sort()};
    }

    function filterFonts(fontsArr, year, tag, teacher) {
      return fontsArr.filter(f => {
        const yearMatch = !year || f.year === year;
        const tagMatch = !tag || (f.tags && f.tags.includes(tag));
        const teacherMatch = !teacher || (f.teacher === teacher);
        return yearMatch && tagMatch && teacherMatch;
      });
    }

    // Controls
    const fontColor = document.getElementById('fontColor');
    const bgColor = document.getElementById('bgColor');
    const fontSize = document.getElementById('fontSize');
    const fontSizeValue = document.getElementById('fontSizeValue');
    const letterSpacing = document.getElementById('letterSpacing');
    const letterSpacingValue = document.getElementById('letterSpacingValue');
    const yearFilter = document.getElementById('yearFilter');
    const teacherFilter = document.getElementById('teacherFilter');
    const output = document.getElementById('output');
    let previewStyles = {
      color: fontColor.value,
      background: bgColor.value,
      fontSize: fontSize.value + 'px',
      letterSpacing: letterSpacing.value + 'em',
    };

    function populateFilters(fontsArr) {
      const {years, tags} = extractYearsAndTags(fontsArr);
      yearFilter.innerHTML = `<option value="">All years</option>` + 
        years.map(y => `<option value="${y}">${y}</option>`).join('');
    }

    function renderCatalogue(filteredFonts) {
      output.innerHTML = '';
      const years = groupFonts(filteredFonts);
      Object.keys(years).sort().forEach(year => {
        const yearDiv = document.createElement('div');
        yearDiv.className = 'year-block';
        yearDiv.innerHTML = `<div class="year-title">${year}</div>`;
        Object.keys(years[year]).sort().forEach(author => {
          const authorDiv = document.createElement('div');
          authorDiv.className = 'author-block';
          authorDiv.innerHTML = `<div class="author-title">${author}</div>`;
          const fontEntries = years[year][author].filter(e => e.file || e.name);
          if (fontEntries.length === 0) return;
          const fontList = document.createElement('div');
          fontList.className = 'font-list';
          if(fontEntries.length === 1) fontList.classList.add('single-column');
          fontEntries.forEach((font, idx) => {
            const fontDiv = document.createElement('div');
            fontDiv.className = 'font-item';
            if(fontEntries.length === 1) fontDiv.classList.add('single-column');
            let preview = '';
            if (font.file && (font.file.endsWith('.otf') || font.file.endsWith('.ttf'))) {
              const fam = registerFont(font.file, font.name || 'Font', year + author + idx);
              preview = `<span class="font-preview" contenteditable="true"
                spellcheck="false"
                style="font-family: '${fam}', sans-serif; color: ${previewStyles.color}; background: ${previewStyles.background}; font-size: ${previewStyles.fontSize}; letter-spacing: ${previewStyles.letterSpacing};"
                >The quick brown fox jumps over the lazy dog. 1234567890</span>`;
            }
            fontDiv.innerHTML = `
              ${font.name ? `<span class="font-name">${font.name}</span><br>` : ''}
              ${preview}
              ${font.file ? `<a class="font-link" href="${font.file}" download>Download font</a><br>` : ''}
              ${makeSpecimenDisplay(font)}
              ${makePdfDisplay(font.specimen, font.name)}
              ${makeTags(font.tags)}
            `;
            fontList.appendChild(fontDiv);
          });
          authorDiv.appendChild(fontList);
          yearDiv.appendChild(authorDiv);
        });
        output.appendChild(yearDiv);
      });
    }

    populateFilters(fonts);
    renderCatalogue(fonts);

    function updatePreviews() {
      previewStyles.color = fontColor.value;
      previewStyles.background = bgColor.value;
      previewStyles.fontSize = fontSize.value + 'px';
      previewStyles.letterSpacing = letterSpacing.value + 'em';
      fontSizeValue.textContent = fontSize.value;
      letterSpacingValue.textContent = letterSpacing.value;
      document.querySelectorAll('.font-preview').forEach(el => {
        el.style.color = previewStyles.color;
        el.style.background = previewStyles.background;
        el.style.fontSize = previewStyles.fontSize;
        el.style.letterSpacing = previewStyles.letterSpacing;
      });
    }
    fontColor.addEventListener('input', updatePreviews);
    bgColor.addEventListener('input', updatePreviews);
    fontSize.addEventListener('input', updatePreviews);
    letterSpacing.addEventListener('input', updatePreviews);

    // Remove tagFilter references in JS
    // Add tag panel logic:
    let selectedTag = "";
    const tagPanel = document.getElementById('tag-panel');
    const tagBtns = document.querySelectorAll('.tag-btn');

    tagBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        selectedTag = btn.dataset.tag;
        tagBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyFilters();
      });
    });

    function applyFilters() {
      const year = yearFilter.value;
      const teacher = teacherFilter.value;
      const filtered = filterFonts(fonts, year, selectedTag, teacher);
      renderCatalogue(filtered);
      updatePreviews();
    }
    yearFilter.addEventListener('change', applyFilters);
    teacherFilter.addEventListener('change', applyFilters);

    // Fake loading screen
    setTimeout(() => {
      document.getElementById('loading-overlay').style.opacity = 0;
      setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 500);
    }, 900);

  </script>
  <style>
    /* Add this CSS for the tag panel */
    #tag-panel {
      position: sticky;
      top: 8.5em; /* Adjust as needed */
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      padding: 1em 1.5em;
      margin: 1em 0 1.5em 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 100;
    }
    #tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5em;
      justify-content: center;
      margin-top: 0.5em;
    }
    .tag-btn {
      background: #f2f2f2;
      border: none;
      border-radius: 16px;
      padding: 0.4em 1em;
      cursor: pointer;
      transition: background 0.2s;
    } transition: background 0.2s;
    .tag-btn.active,
    .tag-btn:hover {
      background: #262626;
      color: #fff;#262626;
    } color: #fff;
    .tag-panel-title {
      font-weight: bold;
      letter-spacing: 0.05em;
      font-size: 1.1em;.05em;
    } font-size: 1.1em;
    @media (max-width: 600px) {
      #tag-list {idth: 600px) {
        flex-direction: column;
        align-items: center;mn;
      } align-items: center;
    } }
  </style>
</body>le>
</html>
</html>